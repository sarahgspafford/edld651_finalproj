---
title             : "EDLD 651 Final Project: Discriminatory Experiences, Chronic Strain, Social Connectedness, and Psychological Wellbeing Among Individuals With Marginalized Sexual Orientations"
shorttitle        : "EDLD 651 Final Project"

author: 
  - name          : "Maggie Head"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "mhead@uoregon.edu"
  
  - name          : "Sarah Spafford"
    affiliation   : "1"

  - name          : "Heather Terral"
    affiliation   : "1"

affiliation:
  - id            : "1"
    institution   : "University of Oregon"

authornote: |
  Data for this project was taken from Project STRIDE: Stress, Identity and Mental Health. (Meyer, Ilan H., Dohrenwend, Bruce Philip, Schwartz, Sharon, Hunter, Joyce, and Kertzner, Robert M. Project STRIDE: Stress, Identity, and Mental Health, New York City, 2004-2005. Ann Arbor, MI: Inter-university Consortium for Political and Social Research [distributor], 2018-11-28. https://doi.org/10.3886/ICPSR35525.v2)

abstract: |
  This will be an abstract.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : yes
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output:
  papaja::apa6_pdf:
    citation_package: biblatex
    always_allow_html: true
---

```{r libraries}
library(papaja)
r_refs("r-references.bib")
library(haven)
library(janitor)
library(tidyverse)
library(apaTables)
library(rio)
library(qwraps2)
library(lm.beta)
library(ggiraphExtra)
library(psych)
library(lavaan)
library(lavaanPlot)
library(magick)
```

```{r setup}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                     eval=TRUE
                     )
```

# Introduction

# Methods

## Participants

Project STRIDE participants included individuals who had been residing in New York City for a minimum of two years, self-identified as lesbian, gay, bisexual (LGB), or straight, and self-identified as White, Black, or Latino [@projectstride]. 

## Material

## Procedure

## Data analysis

We used `r cite_r("r-references.bib")` for all our analyses.

# Results

## Preliminary Analyses

```{r data import, include = FALSE}
stride <- read_sav("data/project_stride_data.sav") %>% 
  as_tibble() %>% 
  janitor::clean_names()
head(stride)

stridy <- stride %>%
  drop_na(perwellb_2, dis_d_total, chr_gen_2, connect) %>% 
  filter(sexori <= 6) %>% 
    select(sexori,
           age,
           ethnic,
           gender,
           chr_gen_2,
           perwellb_2,
           dis_d_total,
           connect) %>%
  mutate(perwellb_2 = as.numeric(perwellb_2),
         chr_gen_2 = as.numeric(chr_gen_2),
         sexori = as.factor(sexori),
         gender = as.factor(gender),
         ethnic = as.factor(ethnic),
        ethnic = fct_recode(ethnic,
    "White" = "0",
    "Black/African-American" = "1",
    "Latino/Hispanic" = "2"), 
         sexori = fct_recode(sexori,
    "Gay" = "1",
    "Lesbian" = "2",
    "Queer" = "3",
    "Bisexual" = "4",
    "Homosexual" = "5",
    "Other - LGB" = "6"))
```

```{r tidy data, include = FALSE}


stridy_wide <-stridy %>%
  group_by(sexori, ethnic) %>%
  characterize() %>%
  summarize(mean_connect = mean(connect)) %>%
  pivot_wider(
    names_from = ethnic,
    values_from = mean_connect
  )

stridy_long <- stridy_wide %>%
  pivot_longer(cols = c(2:4),
               names_to = "Ethnicity",
               values_to = "Connectedness")
               

```

```{r mean plot, results="asis"}
mean_plot <- stridy %>% 
  group_by(sexori) %>% 
  summarize(mean_disc = mean(dis_d_total)) %>% 
  ggplot(aes(sexori, mean_disc)) +
  geom_col(fill = "plum4", alpha = .75) +
  labs(title = "Experiences of Everyday Discrimination",
       subtitle = "According to Sexual Orientation") +
  xlab("Sexual Orientation") +
  ylab("Average Discriminatory Experiences")
plot(mean_plot)
```

```{r summary table, results= "asis"}
options(qwraps2_markup = "markdown")
summary1 <-
  list("Everyday Discrmination" =
         list("min"       = ~ round(min(dis_d_total, na.rm = TRUE),2),
              "median"    = ~ round(median(dis_d_total, na.rm = TRUE),2),
              "max"       = ~ round(max(dis_d_total, na.rm = TRUE),2),
              "mean (sd)" = ~ qwraps2::mean_sd(dis_d_total, na_rm = TRUE)),
       "Chronic Strain" =
         list("min"       = ~ round(min(chr_gen_2, na.rm = TRUE),2),
              "median"    = ~ round(median(chr_gen_2, na.rm = TRUE),2),
              "max"       = ~ round(max(chr_gen_2, na.rm = TRUE),2),
              "mean (sd)" = ~ qwraps2::mean_sd(chr_gen_2, na_rm = TRUE)),
       "Psychological Wellbeing" =
         list("min"       = ~ round(min(perwellb_2, na.rm = TRUE),2),
              "median"    = ~ round(median(perwellb_2, na.rm = TRUE),2),
              "max"       = ~ round(max(perwellb_2, na.rm = TRUE),2),
              "mean (sd)" = ~ qwraps2::mean_sd(perwellb_2, na_rm = TRUE)),
       "Social Connectedness" =
         list("min"       = ~ round(min(connect, na.rm = TRUE),2),
              "median"    = ~ round(median(connect, na.rm = TRUE),2),
              "max"       = ~ round(max(connect, na.rm = TRUE),2),
              "mean (sd)" = ~ qwraps2::mean_sd(connect, na_rm = TRUE))
  )
table_total <- summary_table(stridy, summary1)
table_total

grouped_table <- summary_table(stridy%>%
                                 mutate_at('sexori', characterize),
                               summaries = summary1, by = c("sexori"))
grouped_table
```

## Primary Analyses

```{r regression, include = FALSE}
mod <- lm(perwellb_2 ~  1 + dis_d_total + chr_gen_2 + connect, data = stridy)
summary(lm.beta(mod))

ggplot(stridy, aes(x = dis_d_total, y = perwellb_2 )) +
   geom_point(color = "orange") +
   geom_smooth(method = "lm") +
  labs(x = "Discrimination", y = "Pychological Wellbeing") +
  theme(text=element_text(size=12,  family="serif"))
  

```

```{r correlation panels, results="asis"}
cor_labels <- list(chr_gen_2 = "Chronic Strain", perwellb_2 = "Psychological Wellbeing", dis_d_total = "Discrimination", connect = "Social Connectedness")

pairs.panels(stridy[,-c(1:4)], 
             method = "pearson", 
             hist.col = "darkmagenta",
             density = FALSE,
             ellipses = FALSE,
             lm = TRUE, 
             labels = cor_labels)

cor.mat <- cor(stridy[,-c(1:4)], use = 'pairwise.complete.obs')
round(cor.mat,3)

```

```{r lavaan plot }

model <- 'perwellb_2 ~ dis_d_total + chr_gen_2 + connect'

fit <- sem(model, data = stridy)
summary(fit)

labels <- list(perwellb_2 = "Psychological Wellbeing", dis_d_total = "Discrimination", chr_gen_2 = "Chronic Strain", connect = "Social Connectedness")

lavaanPlot(model = fit, labels = labels, node_options = list(shape = "box", fontname = "Garamond"), edge_options = list(color = "black"), coefs = T, stars = c("regress"))
```

# Discussion

\newpage

# References

```{=tex}
\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}
```
::: {#refs custom-style="Bibliography"}
:::

\endgroup
